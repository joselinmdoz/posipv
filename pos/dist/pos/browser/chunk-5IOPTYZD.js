import{a as W}from"./chunk-BVO7AZOG.js";import{a as w}from"./chunk-IJJ5UOPG.js";import{a as E}from"./chunk-OGHJEGVW.js";import{b as I,c as D,d as T,f as R,g as N,h as F,j as k}from"./chunk-5CMZHIZT.js";import"./chunk-XZ3PRBQD.js";import{Aa as h,Ea as c,Ka as p,La as t,Ma as e,N as u,Pa as S,Qa as C,Ya as n,Za as s,ab as f,ba as g,bb as v,cb as x,j as _,kb as M,pa as a,v as y,wb as b,xb as P,zb as O}from"./chunk-EVJ26B7U.js";function A(l,o){if(l&1&&(t(0,"option",17),n(1),e()),l&2){let r=o.$implicit;p("value",r.id),a(),s(r.name)}}function L(l,o){l&1&&(t(0,"div",2),n(1,"Backend pendiente: "),t(2,"code"),n(3,"/api/reports/sales-by-product"),e()())}function j(l,o){if(l&1&&(t(0,"div",18)(1,"div",19),n(2),e(),t(3,"div",13),n(4),e(),t(5,"div",13),n(6),e(),t(7,"div",13),n(8),e(),t(9,"div",13),n(10),e()()),l&2){let r=o.$implicit,i=C();a(2),s(r.name),a(2),s(r.qty),a(2),s(i.money(r.total)),a(2),s(i.money(r.cashTotal??0)),a(2),s(i.money(r.transferTotal??0))}}function z(l,o){l&1&&(t(0,"div",20),n(1,"Sin resultados."),e())}function V(l,o){if(l&1&&(t(0,"div",21)(1,"div")(2,"div",2),n(3,"Total general"),e(),t(4,"div",22),n(5),e()(),t(6,"div",23)(7,"div",2),n(8,"Tickets / d\xEDa"),e(),t(9,"div",2),n(10,"*(puede a\xF1adirse luego)*"),e()()()),l&2){let r=C();a(5),s(r.money(r.total()))}}var B=class l{api=u(W);regApi=u(w);toast=u(E);registers=g([]);lines=g([]);busy=g(!1);error=g(null);from=this.isoDate(new Date(Date.now()-168*3600*1e3));to=this.isoDate(new Date);registerId="";total=M(()=>this.lines().reduce((o,r)=>o+(r.total||0),0));constructor(){this.regApi.list().pipe(y(()=>_([]))).subscribe(o=>this.registers.set(o)),this.load()}load(){this.busy.set(!0),this.error.set(null),this.api.salesByProduct({from:this.from,to:this.to,registerId:this.registerId||void 0}).pipe(y(()=>(this.error.set("sales_report_failed"),this.toast.push({kind:"error",title:"No se pudo consultar",message:"Verifica /api/reports/sales-by-product"}),_([])))).subscribe(o=>{this.lines.set(o),this.busy.set(!1)})}money(o){return new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(o||0)}isoDate(o){let r=o.getFullYear(),i=String(o.getMonth()+1).padStart(2,"0"),m=String(o.getDate()).padStart(2,"0");return`${r}-${i}-${m}`}static \u0275fac=function(r){return new(r||l)};static \u0275cmp=h({type:l,selectors:[["ng-component"]],decls:42,vars:8,consts:[[1,"page"],[1,"page-head"],[1,"muted"],[1,"btn",3,"click"],[1,"card"],[1,"filters"],["type","date",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","muted",4,"ngIf"],[1,"table"],[1,"th"],[1,"r"],["class","tr",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],["class","totals",4,"ngIf"],[3,"value"],[1,"tr"],[1,"name"],[1,"empty"],[1,"totals"],[1,"big"],[1,"right"]],template:function(r,i){r&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),n(4,"Reporte: Ventas por producto"),e(),t(5,"p",2),n(6,"Agrupa las ventas por producto y separa por m\xE9todo de pago si el backend lo entrega."),e()(),t(7,"button",3),S("click",function(){return i.load()}),n(8,"Consultar"),e()(),t(9,"div",4)(10,"div",5)(11,"label")(12,"span"),n(13,"Desde"),e(),t(14,"input",6),x("ngModelChange",function(d){return v(i.from,d)||(i.from=d),d}),e()(),t(15,"label")(16,"span"),n(17,"Hasta"),e(),t(18,"input",6),x("ngModelChange",function(d){return v(i.to,d)||(i.to=d),d}),e()(),t(19,"label")(20,"span"),n(21,"Caja"),e(),t(22,"select",7),x("ngModelChange",function(d){return v(i.registerId,d)||(i.registerId=d),d}),t(23,"option",8),n(24,"Todas"),e(),c(25,A,2,2,"option",9),e()()(),c(26,L,4,0,"div",10),t(27,"div",11)(28,"div",12)(29,"div"),n(30,"Producto"),e(),t(31,"div",13),n(32,"Cant."),e(),t(33,"div",13),n(34,"Total"),e(),t(35,"div",13),n(36,"Efectivo"),e(),t(37,"div",13),n(38,"Transfer."),e()(),c(39,j,11,5,"div",14)(40,z,2,0,"div",15),e(),c(41,V,11,1,"div",16),e()()),r&2&&(a(14),f("ngModel",i.from),a(4),f("ngModel",i.to),a(4),f("ngModel",i.registerId),a(3),p("ngForOf",i.registers()),a(),p("ngIf",i.error()),a(13),p("ngForOf",i.lines()),a(),p("ngIf",i.lines().length===0&&!i.busy()),a(),p("ngIf",i.lines().length))},dependencies:[O,b,P,k,N,F,I,R,D,T],styles:[".page[_ngcontent-%COMP%]{padding:18px}.page-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-end;flex-wrap:wrap}h1[_ngcontent-%COMP%]{margin:0;font-size:22px;letter-spacing:-.02em}.muted[_ngcontent-%COMP%]{color:var(--muted)}.btn[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow-sm);margin-top:12px}.filters[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}@media(max-width:980px){.filters[_ngcontent-%COMP%]{grid-template-columns:1fr}}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:10px;border-radius:12px;border:1px solid var(--border);outline:none;background:#fff}.table[_ngcontent-%COMP%]{margin-top:10px;border:1px solid var(--border);border-radius:14px;overflow:hidden}.th[_ngcontent-%COMP%], .tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr .6fr .8fr .8fr .8fr;gap:10px;padding:10px 12px;align-items:center}@media(max-width:980px){.th[_ngcontent-%COMP%], .tr[_ngcontent-%COMP%]{grid-template-columns:2fr .6fr .8fr}.th[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(4), .th[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(5), .tr[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(4), .tr[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(5){display:none}}.th[_ngcontent-%COMP%]{background:#fafafa;font-size:12px;color:var(--muted);font-weight:700}.tr[_ngcontent-%COMP%]{border-top:1px solid var(--border)}.name[_ngcontent-%COMP%]{font-weight:800}.r[_ngcontent-%COMP%]{text-align:right;font-variant-numeric:tabular-nums}.empty[_ngcontent-%COMP%]{padding:14px;color:var(--muted)}.totals[_ngcontent-%COMP%]{margin-top:12px;display:flex;justify-content:space-between;gap:12px;align-items:flex-end;flex-wrap:wrap}.big[_ngcontent-%COMP%]{font-size:18px;font-weight:900;margin-top:6px}.right[_ngcontent-%COMP%]{text-align:right;margin-left:auto}"]})};export{B as SalesReportComponent};
