import{a as K}from"./chunk-YEB4C4Y6.js";import{a as D}from"./chunk-OGHJEGVW.js";import{b as j,c as L,d as B,e as q,j as A}from"./chunk-5CMZHIZT.js";import"./chunk-XZ3PRBQD.js";import{Aa as T,Ea as m,Ka as c,La as i,Ma as t,N as E,Na as y,Oa as h,Pa as x,Qa as s,S as u,Sa as k,T as _,Ta as N,Ua as V,Wa as S,Ya as o,Za as g,_a as b,ab as f,ba as C,bb as v,cb as w,j as M,kb as F,na as P,pa as a,v as I,wb as U,xb as z,zb as W}from"./chunk-EVJ26B7U.js";var Q=["imageInput"];function G(n,r){n&1&&(i(0,"div",33)(1,"span"),o(2,"Haz clic para seleccionar imagen"),t()())}function H(n,r){if(n&1&&y(0,"img",34),n&2){let e=s(2);c("src",e.newImagePreview,P)}}function $(n,r){if(n&1){let e=h();i(0,"button",6),x("click",function(){u(e);let l=s(2);return _(l.cancelEdit())}),o(1,"Cancelar"),t()}}function Y(n,r){n&1&&(i(0,"span",3),o(1,"Guardando\u2026"),t())}function J(n,r){if(n&1){let e=h();i(0,"div",8)(1,"h2"),o(2),t(),i(3,"div",18)(4,"div",19)(5,"label")(6,"span"),o(7,"Nombre"),t(),i(8,"input",20),w("ngModelChange",function(l){u(e);let p=s();return v(p.newName,l)||(p.newName=l),_(l)}),t()(),i(9,"label")(10,"span"),o(11,"Precio de venta"),t(),i(12,"input",21),w("ngModelChange",function(l){u(e);let p=s();return v(p.newPrice,l)||(p.newPrice=l),_(l)}),t()(),i(13,"label")(14,"span"),o(15,"Precio de costo"),t(),i(16,"input",22),w("ngModelChange",function(l){u(e);let p=s();return v(p.newCost,l)||(p.newCost=l),_(l)}),t()(),i(17,"label")(18,"span"),o(19,"Unidad de medida"),t(),i(20,"input",23),w("ngModelChange",function(l){u(e);let p=s();return v(p.newUnit,l)||(p.newUnit=l),_(l)}),t()()(),i(21,"div",24)(22,"div",25)(23,"label")(24,"span"),o(25,"Imagen del producto"),t(),i(26,"div",26),x("click",function(){u(e);let l=s();return _(l.openFileSelector())}),m(27,G,3,0,"div",27)(28,H,1,1,"img",28),t(),i(29,"input",29,0),x("change",function(l){u(e);let p=s();return _(p.onFileSelected(l))}),t()()()()(),i(31,"div",30)(32,"button",31),x("click",function(){u(e);let l=s();return _(l.create())}),o(33),t(),m(34,$,2,0,"button",32)(35,Y,2,0,"span",14),t()()}if(n&2){let e=s();a(2),g(e.editingId?"Editar producto":"Crear producto"),a(6),f("ngModel",e.newName),a(4),f("ngModel",e.newPrice),a(4),f("ngModel",e.newCost),a(4),f("ngModel",e.newUnit),a(7),c("ngIf",!e.newImagePreview),a(),c("ngIf",e.newImagePreview),a(4),c("disabled",e.busy()||!e.newName||!e.newPrice),a(),b(" ",e.editingId?"Actualizar":"Guardar"," "),a(),c("ngIf",e.editingId),a(),c("ngIf",e.busy())}}function X(n,r){n&1&&(i(0,"div",3),o(1,"Backend pendiente: "),i(2,"code"),o(3,"/api/products"),t()())}function Z(n,r){if(n&1&&y(0,"img",44),n&2){let e=s().$implicit;c("src",e.image,P)}}function ee(n,r){n&1&&(i(0,"span",3),o(1,"\u2014"),t())}function te(n,r){if(n&1&&(i(0,"code"),o(1),t()),n&2){let e=s().$implicit;a(),g(e.sku)}}function ne(n,r){n&1&&(i(0,"span",3),o(1,"\u2014"),t())}function ie(n,r){if(n&1&&(i(0,"code"),o(1),t()),n&2){let e=s().$implicit;a(),g(e.barcode)}}function re(n,r){n&1&&(i(0,"span",3),o(1,"\u2014"),t())}function oe(n,r){if(n&1){let e=h();i(0,"div",39)(1,"div",40),m(2,Z,1,1,"img",41)(3,ee,2,0,"span",14),t(),i(4,"div",42),o(5),t(),i(6,"div"),m(7,te,2,1,"code",43)(8,ne,2,0,"span",14),t(),i(9,"div"),m(10,ie,2,1,"code",43)(11,re,2,0,"span",14),t(),i(12,"div"),o(13),t(),i(14,"div",37),o(15),t(),i(16,"div",37),o(17),t(),i(18,"div",4)(19,"button",13),x("click",function(){let l=u(e).$implicit,p=s(2);return _(p.editProduct(l))}),o(20,"Editar"),t()()()}if(n&2){let e=r.$implicit,d=s(2);a(2),c("ngIf",e.image),a(),c("ngIf",!e.image),a(2),g(e.name),a(2),c("ngIf",e.sku),a(),c("ngIf",!e.sku),a(2),c("ngIf",e.barcode),a(),c("ngIf",!e.barcode),a(2),g(e.unit||"\u2014"),a(2),g(e.cost?d.money(e.cost):"\u2014"),a(2),g(d.money(e.price))}}function ae(n,r){if(n&1&&(i(0,"div",35)(1,"div",36)(2,"div"),o(3,"Imagen"),t(),i(4,"div"),o(5,"Nombre"),t(),i(6,"div"),o(7,"SKU"),t(),i(8,"div"),o(9,"Barcode"),t(),i(10,"div"),o(11,"Unidad"),t(),i(12,"div",37),o(13,"Costo"),t(),i(14,"div",37),o(15,"Precio"),t(),i(16,"div"),o(17,"Acciones"),t()(),m(18,oe,21,10,"div",38),t()),n&2){let e=s();a(18),c("ngForOf",e.filtered())}}function de(n,r){if(n&1&&y(0,"img",57),n&2){let e=s().$implicit;c("src",e.image,P)}}function le(n,r){n&1&&(i(0,"div",58)(1,"span"),o(2,"Sin imagen"),t()())}function ce(n,r){if(n&1&&(i(0,"div",55)(1,"strong"),o(2,"SKU:"),t(),i(3,"code"),o(4),t()()),n&2){let e=s().$implicit;a(4),g(e.sku)}}function se(n,r){if(n&1&&(i(0,"div",55)(1,"strong"),o(2,"Barcode:"),t(),i(3,"code"),o(4),t()()),n&2){let e=s().$implicit;a(4),g(e.barcode)}}function pe(n,r){if(n&1&&(i(0,"div",55)(1,"strong"),o(2,"Unidad:"),t(),o(3),t()),n&2){let e=s().$implicit;a(3),b(" ",e.unit)}}function me(n,r){if(n&1&&(i(0,"div",55)(1,"strong"),o(2,"Costo:"),t(),o(3),t()),n&2){let e=s().$implicit,d=s(2);a(3),b(" ",d.money(e.cost))}}function ge(n,r){if(n&1){let e=h();i(0,"div",47)(1,"div",48),m(2,de,1,1,"img",49)(3,le,3,0,"div",50),t(),i(4,"div",51)(5,"h3",52),o(6),t(),i(7,"div",53),m(8,ce,5,1,"div",54)(9,se,5,1,"div",54)(10,pe,4,1,"div",54),i(11,"div",55)(12,"strong"),o(13,"Precio:"),t(),o(14),t(),m(15,me,4,1,"div",54),t(),i(16,"div",56)(17,"button",13),x("click",function(){let l=u(e).$implicit,p=s(2);return _(p.editProduct(l))}),o(18,"Editar"),t()()()()}if(n&2){let e=r.$implicit,d=s(2);a(2),c("ngIf",e.image),a(),c("ngIf",!e.image),a(3),g(e.name),a(2),c("ngIf",e.sku),a(),c("ngIf",e.barcode),a(),c("ngIf",e.unit),a(4),b(" ",d.money(e.price)),a(),c("ngIf",e.cost)}}function ue(n,r){if(n&1&&(i(0,"div",45),m(1,ge,19,8,"div",46),t()),n&2){let e=s();a(),c("ngForOf",e.filtered())}}function _e(n,r){n&1&&(i(0,"div",59),o(1," No hay productos para mostrar. "),t())}var R=class n{api=E(K);toast=E(D);items=C([]);busy=C(!1);error=C(null);q="";newName="";newPrice=null;newCost=null;newUnit="";newImage=null;newImagePreview=null;showNew=C(!1);editingId=null;viewMode="table";imageInput;filtered=F(()=>{let r=(this.q||"").toLowerCase().trim(),e=this.items();return r?e.filter(d=>[d.name,d.sku??"",d.barcode??""].join(" ").toLowerCase().includes(r)):e});constructor(){this.reload()}toggleNew(){this.showNew.set(!this.showNew())}editProduct(r){this.editingId=r.id,this.newName=r.name,this.newPrice=r.price?Number(r.price):null,this.newCost=r.cost?Number(r.cost):null,this.newUnit=r.unit||"",this.newImage=null,this.newImagePreview=r.image||null,this.showNew.set(!0)}cancelEdit(){this.editingId=null,this.resetForm()}openFileSelector(){this.imageInput.nativeElement.click()}resetForm(){this.newName="",this.newPrice=null,this.newCost=null,this.newUnit="",this.newImage=null,this.newImagePreview=null}onFileSelected(r){let e=r.target.files[0];if(e){this.newImage=e;let d=new FileReader;d.onload=l=>{this.newImagePreview=l.target?.result},d.readAsDataURL(e)}}reload(){this.busy.set(!0),this.error.set(null),this.api.list().pipe(I(r=>(this.error.set("products_failed"),M([])))).subscribe(r=>{this.items.set(r),this.busy.set(!1)})}create(){if(!this.newName||!this.newPrice)return;this.busy.set(!0);let r=new FormData;r.append("name",this.newName),r.append("price",this.newPrice.toString()),this.newCost&&r.append("cost",this.newCost.toString()),this.newUnit&&r.append("unit",this.newUnit),this.newImage?r.append("image",this.newImage):this.editingId&&this.newImagePreview&&!this.newImagePreview.startsWith("data:")&&r.append("existingImage",this.newImagePreview);let e=this.editingId?this.api.updateWithFile(this.editingId,r):this.api.createWithFile(r),d=this.editingId?"Producto actualizado":"Producto creado";e.pipe(I(l=>(this.toast.push({kind:"error",title:"Error",message:"Verifica el backend /api/products"}),M(null)))).subscribe(l=>{l&&(this.toast.push({kind:"success",title:d,message:l.name}),this.editingId?this.items.update(p=>p.map(O=>O.id===this.editingId?l:O)):this.items.update(p=>[l,...p]),this.cancelEdit(),this.showNew.set(!1)),this.busy.set(!1)})}money(r){let e=Number(r);return isFinite(e)?new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(e):r}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=T({type:n,selectors:[["ng-component"]],viewQuery:function(e,d){if(e&1&&k(Q,5),e&2){let l;N(l=V())&&(d.imageInput=l.first)}},decls:28,vars:11,consts:[["imageInput",""],[1,"page"],[1,"page-head"],[1,"muted"],[1,"actions"],[1,"btn","primary",3,"click"],[1,"btn",3,"click"],["class","card",4,"ngIf"],[1,"card"],[1,"row"],[1,"search"],["placeholder","Nombre / SKU / barcode",3,"ngModelChange","ngModel"],[1,"view-toggle"],[1,"btn","small",3,"click"],["class","muted",4,"ngIf"],["class","table",4,"ngIf"],["class","cards",4,"ngIf"],["class","empty",4,"ngIf"],[1,"form-container"],[1,"form-left"],["placeholder","Ej: Coca Cola 355ml",3,"ngModelChange","ngModel"],["type","number","step","0.01","placeholder","0.00",3,"ngModelChange","ngModel"],["type","number","step","0.01","placeholder","Opcional",3,"ngModelChange","ngModel"],["placeholder","Ej: Unidad, Kg, Litro",3,"ngModelChange","ngModel"],[1,"form-right"],[1,"image-upload"],[1,"image-dropzone",3,"click"],["class","image-placeholder",4,"ngIf"],["alt","Preview","class","image-preview-large",3,"src",4,"ngIf"],["type","file","accept","image/*",2,"display","none",3,"change"],[1,"form-actions"],[1,"btn","primary",3,"click","disabled"],["class","btn",3,"click",4,"ngIf"],[1,"image-placeholder"],["alt","Preview",1,"image-preview-large",3,"src"],[1,"table"],[1,"th"],[1,"r"],["class","tr",4,"ngFor","ngForOf"],[1,"tr"],[1,"image-cell"],["alt","Producto","class","product-image",3,"src",4,"ngIf"],[1,"name"],[4,"ngIf"],["alt","Producto",1,"product-image",3,"src"],[1,"cards"],["class","product-card",4,"ngFor","ngForOf"],[1,"product-card"],[1,"card-image"],["alt","Producto","class","card-product-image",3,"src",4,"ngIf"],["class","no-image",4,"ngIf"],[1,"card-content"],[1,"card-title"],[1,"card-details"],["class","detail",4,"ngIf"],[1,"detail"],[1,"card-actions"],["alt","Producto",1,"card-product-image",3,"src"],[1,"no-image"],[1,"empty"]],template:function(e,d){e&1&&(i(0,"div",1)(1,"div",2)(2,"div")(3,"h1"),o(4,"Productos"),t(),i(5,"p",3),o(6,"Cat\xE1logo central: nombre, SKU, c\xF3digo de barras y precios."),t()(),i(7,"div",4)(8,"button",5),x("click",function(){return d.toggleNew()}),o(9),t(),i(10,"button",6),x("click",function(){return d.reload()}),o(11,"Actualizar"),t()()(),m(12,J,36,11,"div",7),i(13,"div",8)(14,"div",9)(15,"label",10)(16,"span",3),o(17,"Buscar"),t(),i(18,"input",11),w("ngModelChange",function(p){return v(d.q,p)||(d.q=p),p}),t()(),i(19,"div",12)(20,"button",13),x("click",function(){return d.viewMode="table"}),o(21," Tabla "),t(),i(22,"button",13),x("click",function(){return d.viewMode="cards"}),o(23," Tarjetas "),t()(),m(24,X,4,0,"div",14),t(),m(25,ae,19,1,"div",15)(26,ue,2,1,"div",16)(27,_e,2,0,"div",17),t()()),e&2&&(a(9),g(d.showNew()?"Cerrar":"Nuevo producto"),a(3),c("ngIf",d.showNew()),a(6),f("ngModel",d.q),a(2),S("primary",d.viewMode==="table"),a(2),S("primary",d.viewMode==="cards"),a(2),c("ngIf",d.error()),a(),c("ngIf",d.viewMode==="table"),a(),c("ngIf",d.viewMode==="cards"),a(),c("ngIf",!d.busy()&&d.filtered().length===0))},dependencies:[W,U,z,A,j,q,L,B],styles:[".page[_ngcontent-%COMP%]{padding:18px}.page-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-end;flex-wrap:wrap}h1[_ngcontent-%COMP%]{margin:0;font-size:24px;letter-spacing:-.02em}h2[_ngcontent-%COMP%]{margin:0 0 10px;font-size:16px}.muted[_ngcontent-%COMP%]{color:var(--muted)}.actions[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}.btn[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}.btn.primary[_ngcontent-%COMP%]{background:var(--brand);color:#fff;border-color:transparent}.btn.small[_ngcontent-%COMP%]{padding:6px 10px;font-size:12px}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow-sm);margin-top:12px}.form-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 300px;gap:20px}@media(max-width:768px){.form-container[_ngcontent-%COMP%]{grid-template-columns:1fr}}.form-left[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:10px}.form-right[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.image-upload[_ngcontent-%COMP%]{flex:1}.image-dropzone[_ngcontent-%COMP%]{border:2px dashed var(--border);border-radius:12px;padding:20px;text-align:center;cursor:pointer;transition:border-color .2s;min-height:200px;display:flex;align-items:center;justify-content:center}.image-dropzone[_ngcontent-%COMP%]:hover{border-color:var(--brand)}.image-placeholder[_ngcontent-%COMP%]{color:var(--muted)}.image-preview-large[_ngcontent-%COMP%]{max-width:100%;max-height:200px;border-radius:8px}.form-actions[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;margin-top:20px}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}input[_ngcontent-%COMP%]{padding:10px;border-radius:12px;border:1px solid var(--border);outline:none}input[_ngcontent-%COMP%]:focus{border-color:#00000059}.row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;grid-column:1/-1}.search[_ngcontent-%COMP%]{flex:1;min-width:260px}.view-toggle[_ngcontent-%COMP%]{display:flex;gap:5px}.table[_ngcontent-%COMP%]{margin-top:10px;border:1px solid var(--border);border-radius:14px;overflow:hidden}.cards[_ngcontent-%COMP%]{margin-top:10px;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.product-card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden;box-shadow:var(--shadow-sm);transition:transform .2s,box-shadow .2s}.product-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.card-image[_ngcontent-%COMP%]{height:160px;background:#f8f9fa;display:flex;align-items:center;justify-content:center;border-bottom:1px solid var(--border)}.card-product-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.no-image[_ngcontent-%COMP%]{color:var(--muted);font-size:14px}.card-content[_ngcontent-%COMP%]{padding:16px}.card-title[_ngcontent-%COMP%]{margin:0 0 12px;font-size:18px;font-weight:600;color:var(--text)}.card-details[_ngcontent-%COMP%]{margin-bottom:12px}.detail[_ngcontent-%COMP%]{font-size:14px;margin-bottom:4px;color:var(--muted)}.detail[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text)}.card-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.th[_ngcontent-%COMP%], .tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:.8fr 2fr 1fr 1fr 1fr .6fr .6fr 1fr;gap:10px;padding:10px 12px;align-items:center}.th[_ngcontent-%COMP%]{background:#fafafa;font-size:12px;color:var(--muted);font-weight:700}.tr[_ngcontent-%COMP%]{border-top:1px solid var(--border)}.name[_ngcontent-%COMP%]{font-weight:700}.r[_ngcontent-%COMP%]{text-align:right;font-variant-numeric:tabular-nums}.empty[_ngcontent-%COMP%]{padding:14px;color:var(--muted)}code[_ngcontent-%COMP%]{background:#f6f6f6;border:1px solid #eee;padding:2px 6px;border-radius:10px}.image-preview[_ngcontent-%COMP%]{margin-top:8px}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100px;max-height:100px;border-radius:8px;border:1px solid var(--border)}.image-cell[_ngcontent-%COMP%]{display:flex;justify-content:center}.product-image[_ngcontent-%COMP%]{width:40px;height:40px;object-fit:cover;border-radius:6px;border:1px solid var(--border)}"]})};export{R as ProductsComponent};
