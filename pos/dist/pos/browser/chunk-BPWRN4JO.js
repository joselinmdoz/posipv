import{a as K}from"./chunk-YEB4C4Y6.js";import{a as J}from"./chunk-BSNL7NNX.js";import{a as q}from"./chunk-OGHJEGVW.js";import{b as L,c as D,d as R,e as B,f as U,g as j,h as z,i as H,j as G}from"./chunk-5CMZHIZT.js";import"./chunk-XZ3PRBQD.js";import{Aa as E,Db as A,Ea as c,I as w,Ka as d,La as t,M as k,Ma as n,N as M,Oa as I,Pa as S,Qa as v,S as x,T as C,Xa as W,Ya as r,Za as m,ab as u,ba as h,bb as g,cb as f,gb as O,hb as P,j as _,pa as a,v as y,wb as T,xb as N,yb as V,zb as F}from"./chunk-EVJ26B7U.js";var b=class l{constructor(i){this.http=i}list(i){let e=new URLSearchParams;i?.warehouseId&&e.set("warehouseId",i.warehouseId),i?.from&&e.set("from",i.from),i?.to&&e.set("to",i.to);let o=e.toString();return this.http.get(`/api/stock-movements${o?"?"+o:""}`)}create(i){return this.http.post("/api/stock-movements",i)}static \u0275fac=function(e){return new(e||l)(k(A))};static \u0275prov=w({token:l,factory:l.\u0275fac,providedIn:"root"})};function Y(l,i){if(l&1&&(t(0,"option",10),r(1),n()),l&2){let e=i.$implicit;d("ngValue",e.id),a(),m(e.name)}}function Z(l,i){if(l&1&&(t(0,"option",10),r(1),n()),l&2){let e=i.$implicit;d("ngValue",e.id),a(),m(e.name)}}function $(l,i){if(l&1){let e=I();t(0,"label")(1,"span"),r(2,"Desde"),n(),t(3,"select",6),f("ngModelChange",function(p){x(e);let s=v();return g(s.fromWarehouseId,p)||(s.fromWarehouseId=p),C(p)}),t(4,"option",10),r(5,"\u2014"),n(),c(6,Z,2,2,"option",11),n()()}if(l&2){let e=v();a(3),u("ngModel",e.fromWarehouseId),a(),d("ngValue",""),a(2),d("ngForOf",e.warehouses())}}function ee(l,i){if(l&1&&(t(0,"option",10),r(1),n()),l&2){let e=i.$implicit;d("ngValue",e.id),a(),m(e.name)}}function te(l,i){if(l&1){let e=I();t(0,"label")(1,"span"),r(2,"Hacia"),n(),t(3,"select",6),f("ngModelChange",function(p){x(e);let s=v();return g(s.toWarehouseId,p)||(s.toWarehouseId=p),C(p)}),t(4,"option",10),r(5,"\u2014"),n(),c(6,ee,2,2,"option",11),n()()}if(l&2){let e=v();a(3),u("ngModel",e.toWarehouseId),a(),d("ngValue",""),a(2),d("ngForOf",e.warehouses())}}function ne(l,i){l&1&&(t(0,"span",2),r(1,"Procesando\u2026"),n())}function ie(l,i){l&1&&(t(0,"span",2),r(1,"Backend pendiente: "),t(2,"code"),r(3,"/api/stock-movements"),n()())}function oe(l,i){if(l&1&&(t(0,"option",10),r(1),n()),l&2){let e=i.$implicit;d("ngValue",e.id),a(),m(e.name)}}function re(l,i){if(l&1&&(t(0,"div",26)(1,"div"),r(2),O(3,"date"),n(),t(4,"div")(5,"span",27),r(6),n()(),t(7,"div",28),r(8),n(),t(9,"div",23),r(10),n(),t(11,"div",2),r(12),n(),t(13,"div",2),r(14),n()()),l&2){let e=i.$implicit,o=v();a(2),m(P(3,8,e.createdAt,"short")),a(3),W(e.type),a(),m(o.label(e.type)),a(2),m(e.productName||e.productId),a(2),m(e.qty),a(2),m(o.route(e)),a(2),m(e.reason||"\u2014")}}function ae(l,i){l&1&&(t(0,"div",29),r(1,"Sin movimientos."),n())}var Q=class l{api=M(b);warehousesApi=M(J);productsApi=M(K);toast=M(q);warehouses=h([]);products=h([]);movements=h([]);busy=h(!1);busyList=h(!1);error=h(null);type="IN";productId="";qty=1;fromWarehouseId="";toWarehouseId="";reason="";filterWarehouseId="";constructor(){this.bootstrap()}bootstrap(){this.warehousesApi.list().pipe(y(()=>_([]))).subscribe(i=>this.warehouses.set(i)),this.productsApi.list().pipe(y(()=>_([]))).subscribe(i=>this.products.set(i)),this.reload()}canCreate(){return!this.productId||!this.qty||this.qty<1?!1:this.type==="IN"?!!this.toWarehouseId:this.type==="OUT"?!!this.fromWarehouseId:this.type==="TRANSFER"?!!this.fromWarehouseId&&!!this.toWarehouseId&&this.fromWarehouseId!==this.toWarehouseId:!1}create(){this.canCreate()&&(this.busy.set(!0),this.api.create({type:this.type,productId:this.productId,qty:Number(this.qty),fromWarehouseId:this.type==="IN"?null:this.fromWarehouseId||null,toWarehouseId:this.type==="OUT"?null:this.toWarehouseId||null,reason:this.reason||null}).pipe(y(()=>(this.error.set("stock_movements_failed"),this.toast.push({kind:"error",title:"No se pudo guardar",message:"Verifica /api/stock-movements"}),_(null)))).subscribe(i=>{i&&(this.toast.push({kind:"success",title:"Movimiento registrado",message:this.label(i.type)}),this.movements.update(e=>[i,...e]),this.productId="",this.qty=1,this.reason=""),this.busy.set(!1)}))}reload(){this.busyList.set(!0),this.api.list({warehouseId:this.filterWarehouseId||void 0}).pipe(y(()=>_([]))).subscribe(i=>{this.movements.set(i),this.busyList.set(!1)})}label(i){return i==="IN"?"Entrada":i==="OUT"?"Salida":"Transferencia"}route(i){let e=o=>this.warehouses().find(p=>p.id===o)?.code||(o?o.slice(0,6):"\u2014");return i.type==="IN"?`\u2192 ${e(i.toWarehouseId)}`:i.type==="OUT"?`${e(i.fromWarehouseId)} \u2192`:`${e(i.fromWarehouseId)} \u2192 ${e(i.toWarehouseId)}`}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=E({type:l,selectors:[["ng-component"]],decls:73,vars:16,consts:[[1,"page"],[1,"page-head"],[1,"muted"],[1,"btn",3,"click"],[1,"card"],[1,"form"],[3,"ngModelChange","ngModel"],["value","IN"],["value","OUT"],["value","TRANSFER"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","number","min","1","step","1",3,"ngModelChange","ngModel"],[4,"ngIf"],[1,"wide"],["placeholder","Ej: Ajuste, merma, reposici\xF3n, transferencia a TPV...",3,"ngModelChange","ngModel"],[1,"row","wide"],[1,"btn","primary",3,"click","disabled"],["class","muted",4,"ngIf"],[1,"row"],[1,"filters"],[1,"table"],[1,"th"],[1,"r"],["class","tr",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"tr"],[1,"pill"],[1,"name"],[1,"empty"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),r(4,"Movimientos de Inventario"),n(),t(5,"p",2),r(6,"Entradas, salidas y transferencias entre almacenes, con motivo."),n()(),t(7,"button",3),S("click",function(){return o.reload()}),r(8,"Actualizar"),n()(),t(9,"div",4)(10,"h2"),r(11,"Nuevo movimiento"),n(),t(12,"div",5)(13,"label")(14,"span"),r(15,"Tipo"),n(),t(16,"select",6),f("ngModelChange",function(s){return g(o.type,s)||(o.type=s),s}),t(17,"option",7),r(18,"Entrada"),n(),t(19,"option",8),r(20,"Salida"),n(),t(21,"option",9),r(22,"Transferencia"),n()()(),t(23,"label")(24,"span"),r(25,"Producto"),n(),t(26,"select",6),f("ngModelChange",function(s){return g(o.productId,s)||(o.productId=s),s}),t(27,"option",10),r(28,"\u2014 Seleccionar \u2014"),n(),c(29,Y,2,2,"option",11),n()(),t(30,"label")(31,"span"),r(32,"Cantidad"),n(),t(33,"input",12),f("ngModelChange",function(s){return g(o.qty,s)||(o.qty=s),s}),n()(),c(34,$,7,3,"label",13)(35,te,7,3,"label",13),t(36,"label",14)(37,"span"),r(38,"Motivo"),n(),t(39,"input",15),f("ngModelChange",function(s){return g(o.reason,s)||(o.reason=s),s}),n()(),t(40,"div",16)(41,"button",17),S("click",function(){return o.create()}),r(42,"Guardar"),n(),c(43,ne,2,0,"span",18)(44,ie,4,0,"span",18),n()()(),t(45,"div",4)(46,"div",19)(47,"h2"),r(48,"Historial"),n(),t(49,"div",20)(50,"label")(51,"span",2),r(52,"Almac\xE9n"),n(),t(53,"select",6),f("ngModelChange",function(s){return g(o.filterWarehouseId,s)||(o.filterWarehouseId=s),s}),S("ngModelChange",function(){return o.reload()}),t(54,"option",10),r(55,"Todos"),n(),c(56,oe,2,2,"option",11),n()()()(),t(57,"div",21)(58,"div",22)(59,"div"),r(60,"Fecha"),n(),t(61,"div"),r(62,"Tipo"),n(),t(63,"div"),r(64,"Producto"),n(),t(65,"div",23),r(66,"Cantidad"),n(),t(67,"div"),r(68,"Ruta"),n(),t(69,"div"),r(70,"Motivo"),n()(),c(71,re,15,11,"div",24)(72,ae,2,0,"div",25),n()()()),e&2&&(a(16),u("ngModel",o.type),a(10),u("ngModel",o.productId),a(),d("ngValue",""),a(2),d("ngForOf",o.products()),a(4),u("ngModel",o.qty),a(),d("ngIf",o.type!=="IN"),a(),d("ngIf",o.type!=="OUT"),a(4),u("ngModel",o.reason),a(2),d("disabled",o.busy()||!o.canCreate()),a(2),d("ngIf",o.busy()),a(),d("ngIf",o.error()),a(9),u("ngModel",o.filterWarehouseId),a(),d("ngValue",""),a(2),d("ngForOf",o.warehouses()),a(15),d("ngForOf",o.movements()),a(),d("ngIf",o.movements().length===0&&!o.busyList()))},dependencies:[F,T,N,G,j,z,L,B,U,D,H,R,V],styles:[".page[_ngcontent-%COMP%]{padding:18px}.page-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-end;flex-wrap:wrap}h1[_ngcontent-%COMP%]{margin:0;font-size:24px;letter-spacing:-.02em}h2[_ngcontent-%COMP%]{margin:0 0 10px;font-size:16px}.muted[_ngcontent-%COMP%]{color:var(--muted)}.btn[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}.btn.primary[_ngcontent-%COMP%]{background:var(--brand);color:#fff;border-color:transparent}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow-sm);margin-top:12px}.form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}.wide[_ngcontent-%COMP%]{grid-column:1/-1}@media(max-width:980px){.form[_ngcontent-%COMP%]{grid-template-columns:1fr}}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:10px;border-radius:12px;border:1px solid var(--border);outline:none;background:#fff}.row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;justify-content:flex-start}.filters[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:flex-end}.table[_ngcontent-%COMP%]{margin-top:10px;border:1px solid var(--border);border-radius:14px;overflow:hidden}.th[_ngcontent-%COMP%], .tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:1.1fr .7fr 1.4fr .6fr 1.1fr 1.4fr;gap:10px;padding:10px 12px;align-items:center}@media(max-width:1100px){.th[_ngcontent-%COMP%], .tr[_ngcontent-%COMP%]{grid-template-columns:1fr .8fr 1.2fr .6fr 1fr}.th[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(6), .tr[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(6){display:none}}.th[_ngcontent-%COMP%]{background:#fafafa;font-size:12px;color:var(--muted);font-weight:700}.tr[_ngcontent-%COMP%]{border-top:1px solid var(--border)}.name[_ngcontent-%COMP%]{font-weight:700}.r[_ngcontent-%COMP%]{text-align:right;font-variant-numeric:tabular-nums}.empty[_ngcontent-%COMP%]{padding:14px;color:var(--muted)}.pill[_ngcontent-%COMP%]{display:inline-flex;padding:2px 10px;border-radius:999px;border:1px solid var(--border);background:#fafafa;font-size:12px;font-weight:800}.pill.IN[_ngcontent-%COMP%]{background:#1987541a;border-color:#19875440}.pill.OUT[_ngcontent-%COMP%]{background:#dc35451a;border-color:#dc354540}.pill.TRANSFER[_ngcontent-%COMP%]{background:#0d6efd1a;border-color:#0d6efd40}"]})};export{Q as StockMovementsComponent};
