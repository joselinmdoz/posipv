import{a as A}from"./chunk-BSNL7NNX.js";import{a as T}from"./chunk-OGHJEGVW.js";import{b as N,c as W,d as I,f as V,g as D,h as F,j as L}from"./chunk-5CMZHIZT.js";import"./chunk-XZ3PRBQD.js";import{Aa as S,Ea as m,Ka as d,La as e,Ma as t,N as y,Oa as M,Pa as x,Qa as c,S as f,T as _,Wa as k,Ya as i,Za as u,ab as b,ba as g,bb as C,cb as w,j as h,pa as r,v,wb as E,xb as P,zb as O}from"./chunk-EVJ26B7U.js";function j(o,a){o&1&&(e(0,"span",2),i(1,"Guardando\u2026"),t())}function B(o,a){if(o&1){let n=M();e(0,"div",8)(1,"h2"),i(2,"Crear almac\xE9n"),t(),e(3,"div",16)(4,"label")(5,"span"),i(6,"Nombre"),t(),e(7,"input",17),w("ngModelChange",function(l){f(n);let p=c();return C(p.newName,l)||(p.newName=l),_(l)}),t()(),e(8,"label")(9,"span"),i(10,"C\xF3digo"),t(),e(11,"input",18),w("ngModelChange",function(l){f(n);let p=c();return C(p.newCode,l)||(p.newCode=l),_(l)}),t()(),e(12,"label")(13,"span"),i(14,"Tipo"),t(),e(15,"select",19),w("ngModelChange",function(l){f(n);let p=c();return C(p.newType,l)||(p.newType=l),_(l)}),e(16,"option",20),i(17,"CENTRAL"),t(),e(18,"option",21),i(19,"TPV"),t()()(),e(20,"div",9)(21,"button",22),x("click",function(){f(n);let l=c();return _(l.create())}),i(22,"Guardar"),t(),m(23,j,2,0,"span",10),t()()()}if(o&2){let n=c();r(7),b("ngModel",n.newName),r(4),b("ngModel",n.newCode),r(4),b("ngModel",n.newType),r(6),d("disabled",n.busy()||!n.newName||!n.newCode),r(2),d("ngIf",n.busy())}}function R(o,a){o&1&&(e(0,"div",2),i(1,"Backend pendiente: "),e(2,"code"),i(3,"/api/warehouses"),t()())}function G(o,a){if(o&1){let n=M();e(0,"button",23),x("click",function(){let l=f(n).$implicit,p=c();return _(p.select(l))}),e(1,"div",24),i(2),t(),e(3,"div",25)(4,"code"),i(5),t(),e(6,"span",26),i(7),t()()()}if(o&2){let n,s=a.$implicit,l=c();k("active",s.id===((n=l.selected())==null?null:n.id)),r(2),u(s.name),r(3),u(s.code),r(2),u(s.type||"\u2014")}}function q(o,a){if(o&1&&(e(0,"p",2),i(1,"Almac\xE9n: "),e(2,"b"),i(3),t()()),o&2){let n=a.ngIf;r(3),u(n.name)}}function K(o,a){o&1&&(e(0,"p",2),i(1,"Selecciona un almac\xE9n para ver su stock."),t())}function U(o,a){if(o&1&&(e(0,"code"),i(1),t()),o&2){let n=c().$implicit;r(),u(n.sku)}}function H(o,a){o&1&&(e(0,"span",2),i(1,"\u2014"),t())}function J(o,a){if(o&1&&(e(0,"div",32)(1,"div",33),i(2),t(),e(3,"div"),m(4,U,2,1,"code",34)(5,H,2,0,"span",10),t(),e(6,"div",29),i(7),t()()),o&2){let n=a.$implicit;r(2),u(n.name),r(2),d("ngIf",n.sku),r(),d("ngIf",!n.sku),r(2),u(n.qty)}}function Q(o,a){o&1&&(e(0,"div",35),i(1,"Sin datos."),t())}function X(o,a){if(o&1&&(e(0,"div",27)(1,"div",28)(2,"div"),i(3,"Producto"),t(),e(4,"div"),i(5,"SKU"),t(),e(6,"div",29),i(7,"Cantidad"),t()(),m(8,J,8,4,"div",30)(9,Q,2,0,"div",31),t()),o&2){let n=c();r(8),d("ngForOf",n.stock()),r(),d("ngIf",!n.busyStock()&&n.stock().length===0)}}var z=class o{api=y(A);toast=y(T);warehouses=g([]);selected=g(null);stock=g([]);busy=g(!1);busyStock=g(!1);error=g(null);showNew=g(!1);newName="";newCode="";newType="TPV";constructor(){this.reload()}toggleNew(){this.showNew.set(!this.showNew())}reload(){this.busy.set(!0),this.error.set(null),this.api.list().pipe(v(()=>(this.error.set("warehouses_failed"),h([])))).subscribe(a=>{this.warehouses.set(a),a.length&&!this.selected()&&this.selected.set(a[0]),this.busy.set(!1)})}select(a){this.selected.set(a),this.stock.set([]),this.loadStock()}loadStock(){let a=this.selected();a&&(this.busyStock.set(!0),this.api.stock(a.id).pipe(v(()=>h([]))).subscribe(n=>{this.stock.set(n),this.busyStock.set(!1)}))}create(){!this.newName||!this.newCode||(this.busy.set(!0),this.api.create({name:this.newName,code:this.newCode,type:this.newType}).pipe(v(()=>(this.toast.push({kind:"error",title:"No se pudo crear",message:"Verifica el backend /api/warehouses"}),h(null)))).subscribe(a=>{a&&(this.toast.push({kind:"success",title:"Almac\xE9n creado",message:a.name}),this.warehouses.update(n=>[a,...n]),this.selected.set(a),this.showNew.set(!1),this.newName="",this.newCode="",this.newType="TPV"),this.busy.set(!1)}))}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=S({type:o,selectors:[["ng-component"]],decls:36,vars:8,consts:[[1,"page"],[1,"page-head"],[1,"muted"],[1,"actions"],[1,"btn","primary",3,"click"],[1,"btn",3,"click"],["class","card",4,"ngIf"],[1,"split"],[1,"card"],[1,"row"],["class","muted",4,"ngIf"],[1,"list"],["class","item",3,"active","click",4,"ngFor","ngForOf"],[1,"btn",3,"click","disabled"],["class","table",4,"ngIf"],[1,"hint"],[1,"form"],["placeholder","Ej: Central Tampa",3,"ngModelChange","ngModel"],["placeholder","Ej: CENTRAL",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value","CENTRAL"],["value","TPV"],[1,"btn","primary",3,"click","disabled"],[1,"item",3,"click"],[1,"title"],[1,"sub"],[1,"pill"],[1,"table"],[1,"th"],[1,"r"],["class","tr",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"tr"],[1,"name"],[4,"ngIf"],[1,"empty"]],template:function(n,s){n&1&&(e(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),i(4,"Almacenes"),t(),e(5,"p",2),i(6,"Centrales y TPV: stock en tiempo real y distribuci\xF3n de productos."),t()(),e(7,"div",3)(8,"button",4),x("click",function(){return s.toggleNew()}),i(9),t(),e(10,"button",5),x("click",function(){return s.reload()}),i(11,"Actualizar"),t()()(),m(12,B,24,5,"div",6),e(13,"div",7)(14,"div",8)(15,"div",9)(16,"div",2),i(17,"Lista de almacenes"),t(),m(18,R,4,0,"div",10),t(),e(19,"div",11),m(20,G,8,5,"button",12),t()(),e(21,"div",8)(22,"div",9)(23,"div")(24,"h2"),i(25,"Stock"),t(),m(26,q,4,1,"p",10)(27,K,2,0,"p",10),t(),e(28,"button",13),x("click",function(){return s.loadStock()}),i(29,"Ver stock"),t()(),m(30,X,10,2,"div",14),e(31,"div",15),i(32," Tip: Las transferencias y ajustes se hacen en "),e(33,"b"),i(34,"Inventario \u2192 Movimientos"),t(),i(35,". "),t()()()()),n&2&&(r(9),u(s.showNew()?"Cerrar":"Nuevo almac\xE9n"),r(3),d("ngIf",s.showNew()),r(6),d("ngIf",s.error()),r(2),d("ngForOf",s.warehouses()),r(6),d("ngIf",s.selected()),r(),d("ngIf",!s.selected()),r(),d("disabled",!s.selected()),r(2),d("ngIf",s.selected()))},dependencies:[O,E,P,L,D,F,N,V,W,I],styles:[".page[_ngcontent-%COMP%]{padding:18px}.page-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-end;flex-wrap:wrap}h1[_ngcontent-%COMP%]{margin:0;font-size:24px;letter-spacing:-.02em}h2[_ngcontent-%COMP%]{margin:0;font-size:16px}.muted[_ngcontent-%COMP%]{color:var(--muted)}.actions[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}.btn[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}.btn.primary[_ngcontent-%COMP%]{background:var(--brand);color:#fff;border-color:transparent}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow-sm);margin-top:12px}.form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}@media(max-width:980px){.form[_ngcontent-%COMP%]{grid-template-columns:1fr}}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:10px;border-radius:12px;border:1px solid var(--border);outline:none;background:#fff}.row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}.split[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1.4fr;gap:12px}@media(max-width:980px){.split[_ngcontent-%COMP%]{grid-template-columns:1fr}}.list[_ngcontent-%COMP%]{margin-top:10px;display:flex;flex-direction:column;gap:8px}.item[_ngcontent-%COMP%]{text-align:left;width:100%;border:1px solid var(--border);background:#fff;border-radius:14px;padding:10px 12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;gap:10px}.item.active[_ngcontent-%COMP%]{border-color:#00000059;box-shadow:var(--shadow-sm)}.title[_ngcontent-%COMP%]{font-weight:800}.sub[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:12px}.pill[_ngcontent-%COMP%]{padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#fafafa;font-size:12px}.table[_ngcontent-%COMP%]{margin-top:10px;border:1px solid var(--border);border-radius:14px;overflow:hidden}.th[_ngcontent-%COMP%], .tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr .7fr;gap:10px;padding:10px 12px;align-items:center}.th[_ngcontent-%COMP%]{background:#fafafa;font-size:12px;color:var(--muted);font-weight:700}.tr[_ngcontent-%COMP%]{border-top:1px solid var(--border)}.name[_ngcontent-%COMP%]{font-weight:700}.r[_ngcontent-%COMP%]{text-align:right;font-variant-numeric:tabular-nums}.empty[_ngcontent-%COMP%]{padding:14px;color:var(--muted)}.hint[_ngcontent-%COMP%]{margin-top:10px;padding:10px;border-radius:14px;border:1px dashed var(--border);color:var(--muted);font-size:13px}code[_ngcontent-%COMP%]{background:#f6f6f6;border:1px solid #eee;padding:2px 6px;border-radius:10px}"]})};export{z as WarehousesComponent};
