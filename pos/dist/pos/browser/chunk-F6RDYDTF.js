import{a as k}from"./chunk-OGHJEGVW.js";import{b as A,c as D,d as T,f as V,g as W,h as F,j as H}from"./chunk-5CMZHIZT.js";import{Aa as O,Db as R,Ea as f,I as S,Ka as p,La as t,M as E,Ma as n,N as y,Oa as P,Pa as _,Qa as m,S as c,T as g,Ya as i,Za as x,ab as C,ba as u,bb as v,cb as h,j as w,pa as s,v as M,wb as N,xb as I,zb as U}from"./chunk-EVJ26B7U.js";var b=class o{constructor(r){this.http=r}list(){return this.http.get("/api/users")}create(r){return this.http.post("/api/users",r)}update(r,e){return this.http.put(`/api/users/${encodeURIComponent(r)}`,e)}resetPassword(r,e){return this.http.post(`/api/users/${encodeURIComponent(r)}/reset-password`,e)}static \u0275fac=function(e){return new(e||o)(E(R))};static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};function B(o,r){o&1&&(t(0,"span",2),i(1,"Guardando\u2026"),n())}function G(o,r){if(o&1){let e=P();t(0,"div",7)(1,"h2"),i(2,"Crear usuario"),n(),t(3,"div",15)(4,"label")(5,"span"),i(6,"Email"),n(),t(7,"input",16),h("ngModelChange",function(a){c(e);let d=m();return v(d.email,a)||(d.email=a),g(a)}),n()(),t(8,"label")(9,"span"),i(10,"Contrase\xF1a"),n(),t(11,"input",17),h("ngModelChange",function(a){c(e);let d=m();return v(d.password,a)||(d.password=a),g(a)}),n()(),t(12,"label")(13,"span"),i(14,"Rol"),n(),t(15,"select",18),h("ngModelChange",function(a){c(e);let d=m();return v(d.role,a)||(d.role=a),g(a)}),t(16,"option",19),i(17,"ADMIN"),n(),t(18,"option",20),i(19,"MANAGER"),n(),t(20,"option",21),i(21,"CASHIER"),n()()(),t(22,"div",22)(23,"button",23),_("click",function(){c(e);let a=m();return g(a.create())}),i(24,"Crear"),n(),f(25,B,2,0,"span",8),n()()()}if(o&2){let e=m();s(7),C("ngModel",e.email),s(4),C("ngModel",e.password),s(4),C("ngModel",e.role),s(8),p("disabled",e.busy()||!e.email||!e.password),s(2),p("ngIf",e.busy())}}function L(o,r){o&1&&(t(0,"div",2),i(1,"Backend pendiente: "),t(2,"code"),i(3,"/api/users"),n()())}function q(o,r){if(o&1&&(t(0,"div",24)(1,"div",25),i(2),n(),t(3,"div")(4,"code"),i(5),n()(),t(6,"div",11),i(7),n()()),o&2){let e=r.$implicit;s(2),x(e.email),s(3),x(e.role),s(2),x(e.active===!1?"No":"S\xED")}}function J(o,r){o&1&&(t(0,"div",26),i(1,"Sin usuarios."),n())}var j=class o{api=y(b);toast=y(k);users=u([]);busy=u(!1);error=u(null);showNew=u(!1);email="";password="";role="CASHIER";constructor(){this.reload()}toggleNew(){this.showNew.set(!this.showNew())}reload(){this.busy.set(!0),this.error.set(null),this.api.list().pipe(M(()=>(this.error.set("users_failed"),w([])))).subscribe(r=>{this.users.set(r),this.busy.set(!1)})}create(){!this.email||!this.password||(this.busy.set(!0),this.api.create({email:this.email,password:this.password,role:this.role}).pipe(M(()=>(this.toast.push({kind:"error",title:"No se pudo crear",message:"Verifica /api/users"}),w(null)))).subscribe(r=>{r&&(this.toast.push({kind:"success",title:"Usuario creado",message:r.email}),this.users.update(e=>[r,...e]),this.email="",this.password="",this.role="CASHIER",this.showNew.set(!1)),this.busy.set(!1)}))}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["ng-component"]],decls:30,vars:5,consts:[[1,"page"],[1,"page-head"],[1,"muted"],[1,"actions"],[1,"btn","primary",3,"click"],[1,"btn",3,"click"],["class","card",4,"ngIf"],[1,"card"],["class","muted",4,"ngIf"],[1,"table"],[1,"th"],[1,"r"],["class","tr",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"note","mt"],[1,"form"],["placeholder","usuario@empresa.com",3,"ngModelChange","ngModel"],["type","password",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value","ADMIN"],["value","MANAGER"],["value","CASHIER"],[1,"row","wide"],[1,"btn","primary",3,"click","disabled"],[1,"tr"],[1,"name"],[1,"empty"]],template:function(e,l){e&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),i(4,"Usuarios"),n(),t(5,"p",2),i(6,"Control de acceso: Admin, Manager, Cashier."),n()(),t(7,"div",3)(8,"button",4),_("click",function(){return l.toggleNew()}),i(9),n(),t(10,"button",5),_("click",function(){return l.reload()}),i(11,"Actualizar"),n()()(),f(12,G,26,5,"div",6),t(13,"div",7),f(14,L,4,0,"div",8),t(15,"div",9)(16,"div",10)(17,"div"),i(18,"Email"),n(),t(19,"div"),i(20,"Rol"),n(),t(21,"div",11),i(22,"Activo"),n()(),f(23,q,8,3,"div",12)(24,J,2,0,"div",13),n(),t(25,"div",14),i(26," CEO move: "),t(27,"b"),i(28,"m\xEDnimo privilegio"),n(),i(29,". A la caja dale CASHIER, no ADMIN. "),n()()()),e&2&&(s(9),x(l.showNew()?"Cerrar":"Nuevo usuario"),s(3),p("ngIf",l.showNew()),s(2),p("ngIf",l.error()),s(9),p("ngForOf",l.users()),s(),p("ngIf",l.users().length===0&&!l.busy()))},dependencies:[U,N,I,H,W,F,A,V,D,T],styles:[".page[_ngcontent-%COMP%]{padding:18px}.page-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-end;flex-wrap:wrap}h1[_ngcontent-%COMP%]{margin:0;font-size:22px;letter-spacing:-.02em}h2[_ngcontent-%COMP%]{margin:0 0 10px;font-size:16px}.muted[_ngcontent-%COMP%]{color:var(--muted)}.actions[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}.btn[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}.btn.primary[_ngcontent-%COMP%]{background:var(--brand);color:#fff;border-color:transparent}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow-sm);margin-top:12px}.form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}.wide[_ngcontent-%COMP%]{grid-column:1/-1}@media(max-width:980px){.form[_ngcontent-%COMP%]{grid-template-columns:1fr}}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:10px;border-radius:12px;border:1px solid var(--border);outline:none;background:#fff}.row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.table[_ngcontent-%COMP%]{margin-top:10px;border:1px solid var(--border);border-radius:14px;overflow:hidden}.th[_ngcontent-%COMP%], .tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr .6fr;gap:10px;padding:10px 12px;align-items:center}.th[_ngcontent-%COMP%]{background:#fafafa;font-size:12px;color:var(--muted);font-weight:700}.tr[_ngcontent-%COMP%]{border-top:1px solid var(--border)}.name[_ngcontent-%COMP%]{font-weight:800}.r[_ngcontent-%COMP%]{text-align:right}.empty[_ngcontent-%COMP%]{padding:14px;color:var(--muted)}.mt[_ngcontent-%COMP%]{margin-top:12px}.note[_ngcontent-%COMP%]{padding:12px;border-radius:14px;border:1px dashed var(--border);color:var(--muted)}code[_ngcontent-%COMP%]{background:#f6f6f6;border:1px solid #eee;padding:2px 6px;border-radius:10px}"]})};export{j as UsersComponent};
