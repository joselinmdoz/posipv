import{a as z}from"./chunk-BSNL7NNX.js";import{a as N}from"./chunk-OGHJEGVW.js";import{b as V,c as D,d as T,e as W,f as F,g as q,h as A,i as L,j}from"./chunk-5CMZHIZT.js";import"./chunk-XZ3PRBQD.js";import{Aa as w,Db as E,Ea as m,Ka as s,La as i,Ma as t,N as v,Oa as S,Pa as _,Qa as f,S as C,T as M,Ya as o,Za as h,ab as b,ba as p,bb as x,cb as I,j as u,pa as d,v as g,wb as P,xb as O,zb as k}from"./chunk-EVJ26B7U.js";function G(a,n){if(a&1&&(i(0,"option",12),o(1),t()),a&2){let e=n.$implicit;s("value",e.id),d(),h(e.name)}}function H(a,n){a&1&&(i(0,"div",2),o(1,"Backend pendiente: "),i(2,"code"),o(3,"/api/ipv/initial"),t()())}function J(a,n){if(a&1){let e=S();i(0,"div",18)(1,"div",19),o(2),t(),i(3,"div",15),o(4),t(),i(5,"div",15)(6,"input",20),I("ngModelChange",function(l){let c=C(e).index,y=f(2);return x(y.initial()[c].qty,l)||(y.initial()[c].qty=l),M(l)}),t()()()}if(a&2){let e=n.$implicit,r=n.index,l=f(2);d(2),h(e.name),d(2),h(e.qty),d(2),b("ngModel",l.initial()[r].qty)}}function K(a,n){a&1&&(i(0,"div",21),o(1,"Sin datos."),t())}function Q(a,n){if(a&1&&(i(0,"div",13)(1,"div",14)(2,"div"),o(3,"Producto"),t(),i(4,"div",15),o(5,"Stock actual"),t(),i(6,"div",15),o(7,"IPV inicial"),t()(),m(8,J,7,3,"div",16)(9,K,2,0,"div",17),t()),a&2){let e=f();d(8),s("ngForOf",e.stock()),d(),s("ngIf",e.stock().length===0&&!e.busyStock())}}var B=class a{warehousesApi=v(z);http=v(E);toast=v(N);warehouses=p([]);warehouseId="";stock=p([]);initial=p([]);busy=p(!1);busyStock=p(!1);error=p(null);constructor(){this.warehousesApi.list().pipe(g(()=>u([]))).subscribe(n=>this.warehouses.set(n))}loadStock(){this.warehouseId&&(this.busyStock.set(!0),this.warehousesApi.stock(this.warehouseId).pipe(g(()=>u([]))).subscribe(n=>{this.stock.set(n),this.initial.set(n.map(e=>({productId:e.productId,qty:e.qty}))),this.busyStock.set(!1)}))}save(){if(!this.warehouseId)return;this.busy.set(!0);let n={warehouseId:this.warehouseId,lines:this.initial()};this.http.post("/api/ipv/initial",n).pipe(g(()=>(this.error.set("ipv_initial_failed"),this.toast.push({kind:"error",title:"No se pudo guardar",message:"Verifica /api/ipv/initial"}),u(null)))).subscribe(()=>{this.toast.push({kind:"success",title:"IPV inicial guardado",message:"Listo para iniciar turno"}),this.busy.set(!1)})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["ng-component"]],decls:22,vars:5,consts:[[1,"page"],[1,"page-head"],[1,"muted"],[1,"btn","primary",3,"click","disabled"],[1,"card"],[1,"filters"],[3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","muted",4,"ngIf"],["class","table",4,"ngIf"],[1,"note","mt"],[3,"value"],[1,"table"],[1,"th"],[1,"r"],["class","tr",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"tr"],[1,"name"],["type","number","min","0","step","1",3,"ngModelChange","ngModel"],[1,"empty"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),o(4,"IPV Inicial"),t(),i(5,"p",2),o(6,"Carga el inventario inicial por almac\xE9n antes del turno (base para el IPV)."),t()(),i(7,"button",3),_("click",function(){return r.save()}),o(8,"Guardar"),t()(),i(9,"div",4)(10,"div",5)(11,"label")(12,"span"),o(13,"Almac\xE9n"),t(),i(14,"select",6),I("ngModelChange",function(c){return x(r.warehouseId,c)||(r.warehouseId=c),c}),_("ngModelChange",function(){return r.loadStock()}),i(15,"option",7),o(16,"\u2014 Seleccionar \u2014"),t(),m(17,G,2,2,"option",8),t()(),m(18,H,4,0,"div",9),t(),m(19,Q,10,2,"div",10),i(20,"div",11),o(21," Consejo: si el turno inicia en un almac\xE9n TPV, el IPV inicial deber\xEDa coincidir con lo que realmente hay en estanter\xEDa. "),t()()()),e&2&&(d(7),s("disabled",!r.warehouseId||r.busy()),d(7),b("ngModel",r.warehouseId),d(3),s("ngForOf",r.warehouses()),d(),s("ngIf",r.error()),d(),s("ngIf",r.warehouseId))},dependencies:[k,P,O,j,q,A,V,W,F,D,L,T],styles:[".page[_ngcontent-%COMP%]{padding:18px}.page-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-end;flex-wrap:wrap}h1[_ngcontent-%COMP%]{margin:0;font-size:22px;letter-spacing:-.02em}.muted[_ngcontent-%COMP%]{color:var(--muted)}.btn[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}.btn.primary[_ngcontent-%COMP%]{background:var(--brand);color:#fff;border-color:transparent}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow-sm);margin-top:12px}.filters[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:end;flex-wrap:wrap}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted);min-width:260px}select[_ngcontent-%COMP%]{padding:10px;border-radius:12px;border:1px solid var(--border);outline:none;background:#fff}.table[_ngcontent-%COMP%]{margin-top:10px;border:1px solid var(--border);border-radius:14px;overflow:hidden}.th[_ngcontent-%COMP%], .tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr .7fr .7fr;gap:10px;padding:10px 12px;align-items:center}.th[_ngcontent-%COMP%]{background:#fafafa;font-size:12px;color:var(--muted);font-weight:700}.tr[_ngcontent-%COMP%]{border-top:1px solid var(--border)}.name[_ngcontent-%COMP%]{font-weight:800}.r[_ngcontent-%COMP%]{text-align:right;font-variant-numeric:tabular-nums}input[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:12px;border:1px solid var(--border);outline:none;text-align:right}.empty[_ngcontent-%COMP%]{padding:14px;color:var(--muted)}.mt[_ngcontent-%COMP%]{margin-top:12px}.note[_ngcontent-%COMP%]{padding:12px;border-radius:14px;border:1px dashed var(--border);color:var(--muted)}"]})};export{B as IpvInitialComponent};
