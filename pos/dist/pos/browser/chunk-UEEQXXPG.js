import{a as V}from"./chunk-BVO7AZOG.js";import{a as W}from"./chunk-W4NJFJ3E.js";import{a as N}from"./chunk-IJJ5UOPG.js";import{a as R}from"./chunk-OGHJEGVW.js";import{c as F,d as k,f as D,g as A,h as j,j as B}from"./chunk-5CMZHIZT.js";import"./chunk-XZ3PRBQD.js";import{Aa as E,Ea as v,Ka as p,La as t,Ma as e,N as c,Pa as I,Qa as f,Ya as n,Za as l,_a as M,ab as h,ba as g,bb as b,cb as C,gb as S,hb as _,j as u,kb as y,pa as a,v as x,wb as O,xb as P,yb as w,zb as T}from"./chunk-EVJ26B7U.js";function L(d,r){if(d&1&&(t(0,"option",14),n(1),e()),d&2){let i=r.$implicit;p("value",i.id),a(),l(i.name)}}function U(d,r){if(d&1&&(t(0,"option",14),n(1),S(2,"date"),e()),d&2){let i,o,m=f();p("value",(i=m.openSession())==null?null:i.id),a(),M("Abierta (",_(2,2,(o=m.openSession())==null?null:o.openedAt,"short"),")")}}function q(d,r){d&1&&(t(0,"div",15),n(1," Selecciona una sesi\xF3n para ver el IPV. "),e())}function G(d,r){if(d&1&&(t(0,"div",24)(1,"div",25),n(2),e(),t(3,"div",21),n(4),e(),t(5,"div",21),n(6),e(),t(7,"div",21),n(8),e(),t(9,"div",21),n(10),e(),t(11,"div",21),n(12),e(),t(13,"div",21),n(14),e(),t(15,"div",21),n(16),e(),t(17,"div",21),n(18),e()()),d&2){let i=r.$implicit,o=f(2);a(2),l(i.name),a(2),l(i.inicio),a(2),l(i.entradas),a(2),l(i.salidas),a(2),l(i.vendido),a(2),l(i.final),a(2),l(o.money(i.precio)),a(2),l(o.money(i.importe)),a(2),l(o.money(i.importeTransferencia))}}function H(d,r){if(d&1&&(t(0,"div")(1,"div",16)(2,"div")(3,"div",2),n(4,"Caja"),e(),t(5,"div",17),n(6),e()(),t(7,"div")(8,"div",2),n(9,"Apertura"),e(),t(10,"div",17),n(11),S(12,"date"),e()(),t(13,"div")(14,"div",2),n(15,"Cierre"),e(),t(16,"div",17),n(17),S(18,"date"),e()(),t(19,"div",18)(20,"div",2),n(21,"Trabajadores"),e(),t(22,"div",17),n(23),e()()(),t(24,"div",19)(25,"div",20)(26,"div"),n(27,"Producto"),e(),t(28,"div",21),n(29,"Inicio"),e(),t(30,"div",21),n(31,"Entradas"),e(),t(32,"div",21),n(33,"Salidas"),e(),t(34,"div",21),n(35,"Vendido"),e(),t(36,"div",21),n(37,"Final"),e(),t(38,"div",21),n(39,"Precio"),e(),t(40,"div",21),n(41,"Importe"),e(),t(42,"div",21),n(43,"Transfer."),e()(),v(44,G,19,9,"div",22),e(),t(45,"div",23)(46,"div")(47,"div",2),n(48,"Total vendido"),e(),t(49,"div",17),n(50),e()(),t(51,"div",18)(52,"div",2),n(53,"Total transferencias"),e(),t(54,"div",17),n(55),e()()()()),d&2){let i=r.ngIf,o=f();a(6),l(i.registerId),a(5),l(_(12,7,i.openedAt,"short")),a(6),l(i.closedAt?_(18,10,i.closedAt,"short"):"\u2014"),a(6),l(o.workersText(i.workers)),a(21),p("ngForOf",i.lines),a(6),l(o.money(o.totalImporte())),a(5),l(o.money(o.totalTransfer()))}}function J(d,r){d&1&&(t(0,"div",2),n(1,"No se pudo cargar el reporte (backend pendiente)."),e())}var z=class d{reports=c(V);regs=c(N);cash=c(W);toast=c(R);registers=g([]);openSession=g(null);report=g(null);error=g(null);registerId="";cashSessionId="";totalImporte=y(()=>(this.report()?.lines||[]).reduce((r,i)=>r+(i.importe||0),0));totalTransfer=y(()=>(this.report()?.lines||[]).reduce((r,i)=>r+(i.importeTransferencia||0),0));constructor(){this.regs.list().pipe(x(()=>u([]))).subscribe(r=>this.registers.set(r))}loadOpenSession(){this.openSession.set(null),this.report.set(null),this.cashSessionId="",this.registerId&&this.cash.getOpen(this.registerId).pipe(x(()=>u(null))).subscribe(r=>{this.openSession.set(r),r?.id&&(this.cashSessionId=r.id)})}load(){this.error.set(null),this.report.set(null),this.cashSessionId&&this.reports.ipv(this.cashSessionId).pipe(x(()=>(this.error.set("ipv_failed"),this.toast.push({kind:"error",title:"No se pudo consultar",message:"Verifica /api/reports/ipv"}),u(null)))).subscribe(r=>this.report.set(r))}money(r){return new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(r||0)}workersText(r){return!r||r.length===0?"\u2014":r.map(i=>i.email).join(", ")}static \u0275fac=function(i){return new(i||d)};static \u0275cmp=E({type:d,selectors:[["ng-component"]],decls:33,vars:7,consts:[[1,"page"],[1,"page-head"],[1,"muted"],[1,"btn",3,"click"],[1,"card"],[1,"filters"],[3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value",4,"ngIf"],[1,"info"],["class","note",4,"ngIf"],[4,"ngIf"],["class","muted",4,"ngIf"],[3,"value"],[1,"note"],[1,"meta"],[1,"big"],[1,"right"],[1,"table"],[1,"th"],[1,"r"],["class","tr",4,"ngFor","ngForOf"],[1,"totals"],[1,"tr"],[1,"name"]],template:function(i,o){i&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),n(4,"Reporte: IPV (Inventario Inicial / Final)"),e(),t(5,"p",2),n(6,"Cuadre por sesi\xF3n: inicio + entradas - salidas - vendido = final."),e()(),t(7,"button",3),I("click",function(){return o.load()}),n(8,"Consultar"),e()(),t(9,"div",4)(10,"div",5)(11,"label")(12,"span"),n(13,"Caja"),e(),t(14,"select",6),C("ngModelChange",function(s){return b(o.registerId,s)||(o.registerId=s),s}),I("ngModelChange",function(){return o.loadOpenSession()}),t(15,"option",7),n(16,"\u2014 Seleccionar \u2014"),e(),v(17,L,2,2,"option",8),e()(),t(18,"label")(19,"span"),n(20,"Sesi\xF3n"),e(),t(21,"select",6),C("ngModelChange",function(s){return b(o.cashSessionId,s)||(o.cashSessionId=s),s}),t(22,"option",7),n(23,"\u2014"),e(),v(24,U,3,5,"option",9),e()(),t(25,"div",10)(26,"div",2),n(27,"Backend:"),e(),t(28,"code"),n(29,"/api/reports/ipv?cashSessionId=\u2026"),e()()(),v(30,q,2,0,"div",11)(31,H,56,13,"div",12)(32,J,2,0,"div",13),e()()),i&2&&(a(14),h("ngModel",o.registerId),a(3),p("ngForOf",o.registers()),a(4),h("ngModel",o.cashSessionId),a(3),p("ngIf",o.openSession()),a(6),p("ngIf",!o.cashSessionId),a(),p("ngIf",o.report()),a(),p("ngIf",o.error()))},dependencies:[T,O,P,B,A,j,D,F,k,w],styles:[".page[_ngcontent-%COMP%]{padding:18px}.page-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-end;flex-wrap:wrap}h1[_ngcontent-%COMP%]{margin:0;font-size:22px;letter-spacing:-.02em}.muted[_ngcontent-%COMP%]{color:var(--muted)}.btn[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow-sm);margin-top:12px}.filters[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1.2fr;gap:10px;align-items:end}@media(max-width:980px){.filters[_ngcontent-%COMP%]{grid-template-columns:1fr}}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}select[_ngcontent-%COMP%]{padding:10px;border-radius:12px;border:1px solid var(--border);outline:none;background:#fff}.info[_ngcontent-%COMP%]{font-size:12px;color:var(--muted)}.note[_ngcontent-%COMP%]{margin-top:10px;padding:12px;border-radius:14px;border:1px dashed var(--border);color:var(--muted)}.meta[_ngcontent-%COMP%]{margin-top:12px;display:flex;gap:16px;flex-wrap:wrap;align-items:flex-end}.big[_ngcontent-%COMP%]{font-weight:900;margin-top:4px}.right[_ngcontent-%COMP%]{margin-left:auto;text-align:right}.table[_ngcontent-%COMP%]{margin-top:10px;border:1px solid var(--border);border-radius:14px;overflow:auto}.th[_ngcontent-%COMP%], .tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr repeat(8,.7fr);gap:10px;padding:10px 12px;align-items:center;min-width:980px}.th[_ngcontent-%COMP%]{position:sticky;top:0;background:#fafafa;font-size:12px;color:var(--muted);font-weight:700;border-bottom:1px solid var(--border)}.tr[_ngcontent-%COMP%]{border-top:1px solid var(--border)}.name[_ngcontent-%COMP%]{font-weight:800}.r[_ngcontent-%COMP%]{text-align:right;font-variant-numeric:tabular-nums}.totals[_ngcontent-%COMP%]{margin-top:12px;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:flex-end}code[_ngcontent-%COMP%]{background:#f6f6f6;border:1px solid #eee;padding:2px 6px;border-radius:10px}"]})};export{z as IpvReportComponent};
