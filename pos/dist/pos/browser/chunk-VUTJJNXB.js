import{a as B}from"./chunk-P5KSWAQ2.js";import{b as I,e as D}from"./chunk-EKOQI3CN.js";import{a as k}from"./chunk-IJJ5UOPG.js";import{a as z}from"./chunk-BSNL7NNX.js";import{a as F}from"./chunk-OGHJEGVW.js";import{b as N,c as W,d as V,e as L,f as R,g as A,h as U,j}from"./chunk-5CMZHIZT.js";import"./chunk-XZ3PRBQD.js";import{Aa as P,Ea as h,Ka as d,La as i,Ma as n,N as u,Oa as C,Pa as f,Qa as _,S,T as M,Ya as r,Za as x,_a as w,ab as b,ba as g,bb as y,cb as v,j as m,pa as l,v as c,wb as E,xb as O,zb as T}from"./chunk-EVJ26B7U.js";function q(s,e){if(s&1&&(i(0,"option",20),r(1),n()),s&2){let t=e.$implicit;d("value",t.id),l(),x(t.name)}}function H(s,e){if(s&1&&(i(0,"option",20),r(1),n()),s&2){let t=e.$implicit;d("value",t.id),l(),x(t.name)}}function J(s,e){if(s&1){let t=C();i(0,"label")(1,"input",21),f("change",function(){let p=S(t).$implicit,a=_();return M(a.togglePaymentMethod(p.code))}),n(),r(2),n()}if(s&2){let t=e.$implicit,o=_();l(),d("checked",o.isPaymentMethodSelected(t.code)),l(),w(" ",t.name," ")}}function K(s,e){if(s&1){let t=C();i(0,"label")(1,"input",21),f("change",function(){let p=S(t).$implicit,a=_();return M(a.toggleDenomination(p.value))}),n(),r(2),n()}if(s&2){let t=e.$implicit,o=_();l(),d("checked",o.isDenominationSelected(t.value)),l(),w(" ",t.value," ")}}function Q(s,e){s&1&&(i(0,"span",2),r(1,"Guardando\u2026"),n())}function X(s,e){s&1&&(i(0,"span",2),r(1,"Backend pendiente: "),i(2,"code"),r(3,"/api/settings/register/:id"),n()())}var G=class s{api=u(B);regs=u(k);warehouses=u(z);toast=u(F);route=u(I);registers=g([]);warehousesList=g([]);paymentMethods=g([]);denominations=g([]);busy=g(!1);error=g(null);registerId="";defaultOpeningFloat=null;currency="CUP";warehouseId="";selectedPaymentMethods=[];selectedDenominations=[];constructor(){this.regs.list().pipe(c(()=>m([]))).subscribe(e=>this.registers.set(e)),this.warehouses.list().pipe(c(()=>m([]))).subscribe(e=>this.warehousesList.set(e)),this.api.listPaymentMethods().pipe(c(()=>m([]))).subscribe(e=>this.paymentMethods.set(e)),this.api.listDenominations().pipe(c(()=>m([]))).subscribe(e=>this.denominations.set(e)),this.route.queryParams.subscribe(e=>{e.registerId&&(this.registerId=e.registerId,this.load())})}load(){this.error.set(null),this.registerId&&this.api.getRegisterSettings(this.registerId).pipe(c(()=>(this.error.set("settings_failed"),m(null)))).subscribe(e=>{e&&(this.defaultOpeningFloat=e.defaultOpeningFloat??0,this.currency=e.currency||"CUP",this.warehouseId=e.warehouseId||"",this.selectedPaymentMethods=e.paymentMethods?.filter(t=>t.enabled).map(t=>t.code)||[],this.selectedDenominations=e.denominations?.filter(t=>t.enabled).map(t=>t.value)||[])})}togglePaymentMethod(e){let t=this.selectedPaymentMethods.indexOf(e);t>-1?this.selectedPaymentMethods.splice(t,1):this.selectedPaymentMethods.push(e)}isPaymentMethodSelected(e){return this.selectedPaymentMethods.includes(e)}toggleDenomination(e){let t=this.selectedDenominations.indexOf(e);t>-1?this.selectedDenominations.splice(t,1):this.selectedDenominations.push(e)}isDenominationSelected(e){return this.selectedDenominations.includes(e)}save(){!this.registerId||this.defaultOpeningFloat==null||(this.busy.set(!0),this.api.saveRegisterSettings(this.registerId,{defaultOpeningFloat:Number(this.defaultOpeningFloat),currency:this.currency,warehouseId:this.warehouseId,paymentMethods:this.selectedPaymentMethods,denominations:this.selectedDenominations}).pipe(c(()=>(this.toast.push({kind:"error",title:"No se pudo guardar",message:"Verifica /api/settings/register/:id"}),m(null)))).subscribe(()=>{this.toast.push({kind:"success",title:"Guardado",message:"Configuraci\xF3n actualizada"}),this.busy.set(!1)}))}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=P({type:s,selectors:[["ng-component"]],decls:60,vars:11,consts:[[1,"page"],[1,"page-head"],[1,"muted"],[1,"actions"],["routerLink","/settings/payment-methods",1,"btn"],["routerLink","/settings/denominations",1,"btn"],[1,"card"],[1,"filters"],[3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","number","step","0.01",3,"ngModelChange","ngModel"],["value","CUP"],["value","USD"],[1,"checkbox-group"],[4,"ngFor","ngForOf"],[1,"row","mt"],[1,"btn","primary",3,"click","disabled"],["class","muted",4,"ngIf"],[1,"note","mt"],[3,"value"],["type","checkbox",3,"change","checked"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),r(4,"Configuraci\xF3n del TPV"),n(),i(5,"p",2),r(6,"Ajustes por caja: fondo inicial y reglas de operaci\xF3n."),n()(),i(7,"div",3)(8,"a",4),r(9,"M\xE9todos de pago"),n(),i(10,"a",5),r(11,"Denominaciones"),n()()(),i(12,"div",6)(13,"div",7)(14,"label")(15,"span"),r(16,"Caja"),n(),i(17,"select",8),v("ngModelChange",function(a){return y(o.registerId,a)||(o.registerId=a),a}),f("ngModelChange",function(){return o.load()}),i(18,"option",9),r(19,"\u2014 Seleccionar \u2014"),n(),h(20,q,2,2,"option",10),n()(),i(21,"label")(22,"span"),r(23,"Fondo inicial (cambio)"),n(),i(24,"input",11),v("ngModelChange",function(a){return y(o.defaultOpeningFloat,a)||(o.defaultOpeningFloat=a),a}),n()(),i(25,"label")(26,"span"),r(27,"Tipo de moneda"),n(),i(28,"select",8),v("ngModelChange",function(a){return y(o.currency,a)||(o.currency=a),a}),i(29,"option",12),r(30,"CUP"),n(),i(31,"option",13),r(32,"USD"),n()()(),i(33,"label")(34,"span"),r(35,"Almac\xE9n"),n(),i(36,"select",8),v("ngModelChange",function(a){return y(o.warehouseId,a)||(o.warehouseId=a),a}),i(37,"option",9),r(38,"\u2014 Seleccionar \u2014"),n(),h(39,H,2,2,"option",10),n()()(),i(40,"div",7)(41,"label")(42,"span"),r(43,"M\xE9todos de pago"),n(),i(44,"div",14),h(45,J,3,2,"label",15),n()(),i(46,"label")(47,"span"),r(48,"Denominaciones"),n(),i(49,"div",14),h(50,K,3,2,"label",15),n()()(),i(51,"div",16)(52,"button",17),f("click",function(){return o.save()}),r(53,"Guardar"),n(),h(54,Q,2,0,"span",18)(55,X,4,0,"span",18),n(),i(56,"div",19)(57,"b"),r(58,"Tip CEO:"),n(),r(59,' Mant\xE9n el fondo inicial estable. Evita "inventarte" el cambio en medio del turno: te rompe el IPV. '),n()()()),t&2&&(l(17),b("ngModel",o.registerId),l(3),d("ngForOf",o.registers()),l(4),b("ngModel",o.defaultOpeningFloat),l(4),b("ngModel",o.currency),l(8),b("ngModel",o.warehouseId),l(3),d("ngForOf",o.warehousesList()),l(6),d("ngForOf",o.paymentMethods()),l(5),d("ngForOf",o.denominations()),l(2),d("disabled",!o.registerId||o.busy()),l(2),d("ngIf",o.busy()),l(),d("ngIf",o.error()))},dependencies:[T,E,O,j,A,U,N,L,R,W,V,D],styles:[".page[_ngcontent-%COMP%]{padding:18px}.page-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-end;flex-wrap:wrap}h1[_ngcontent-%COMP%]{margin:0;font-size:22px;letter-spacing:-.02em}.muted[_ngcontent-%COMP%]{color:var(--muted)}.actions[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}.btn[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer;text-decoration:none}.btn.primary[_ngcontent-%COMP%]{background:var(--brand);color:#fff;border-color:transparent}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow-sm);margin-top:12px}.filters[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:end}@media(max-width:980px){.filters[_ngcontent-%COMP%]{grid-template-columns:1fr}}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:10px;border-radius:12px;border:1px solid var(--border);outline:none;background:#fff}.row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex-wrap:wrap}.mt[_ngcontent-%COMP%]{margin-top:12px}.note[_ngcontent-%COMP%]{padding:12px;border-radius:14px;border:1px dashed var(--border);color:var(--muted)}"]})};export{G as TpvSettingsComponent};
