import{e as q}from"./chunk-EKOQI3CN.js";import{a as R}from"./chunk-W4NJFJ3E.js";import{a as D}from"./chunk-IJJ5UOPG.js";import{a as B}from"./chunk-YEB4C4Y6.js";import{b as j,c as L,d as H,e as W,j as z}from"./chunk-5CMZHIZT.js";import"./chunk-XZ3PRBQD.js";import{$a as N,Aa as k,Db as F,Ea as x,I as E,Ka as l,La as a,M as I,Ma as r,N as b,Oa as C,Pa as f,Qa as p,S as m,T as g,Va as S,Ya as s,Za as u,_a as v,ab as y,ba as _,bb as h,cb as P,ib as w,kb as O,pa as c,wb as T,xb as V,zb as A}from"./chunk-EVJ26B7U.js";var M=class o{constructor(t){this.http=t}createSale(t){return this.http.post("/api/sales",t)}static \u0275fac=function(e){return new(e||o)(I(F))};static \u0275prov=E({token:o,factory:o.\u0275fac,providedIn:"root"})};function G(o,t){o&1&&(a(0,"span"),s(1,"\u2705 Abierta"),r())}function J(o,t){o&1&&s(0,"\u26A0\uFE0F Sin sesi\xF3n")}function Q(o,t){if(o&1&&(a(0,"div",8)(1,"div")(2,"div",9),s(3,"Caja seleccionada"),r(),a(4,"code"),s(5),r()(),a(6,"div")(7,"div",9),s(8,"Sesi\xF3n"),r(),x(9,G,2,0,"span",10)(10,J,1,0,"ng-template",null,0,w),r()()),o&2){let e=t.ngIf,n=S(11),i=p();c(5),u(e),c(4),l("ngIf",i.session())("ngIfElse",n)}}function U(o,t){if(o&1&&(a(0,"p",17),s(1),r()),o&2){let e=p(2);c(),u(e.err())}}function X(o,t){if(o&1){let e=C();a(0,"div",11)(1,"p"),s(2,"Esta caja no tiene sesi\xF3n abierta. Abre la caja para poder vender."),r(),a(3,"div",12)(4,"label")(5,"span"),s(6,"Monto inicial"),r(),a(7,"input",13),P("ngModelChange",function(i){m(e);let d=p();return h(d.opening,i)||(d.opening=i),g(i)}),r()(),a(8,"label")(9,"span"),s(10,"Nota"),r(),a(11,"input",14),P("ngModelChange",function(i){m(e);let d=p();return h(d.note,i)||(d.note=i),g(i)}),r()()(),a(12,"button",15),f("click",function(){m(e);let i=p();return g(i.openSession())}),s(13),r(),x(14,U,2,1,"p",16),r()}if(o&2){let e=p();c(7),y("ngModel",e.opening),c(4),y("ngModel",e.note),c(),l("disabled",e.busy()),c(),u(e.busy()?"Abriendo\u2026":"Abrir caja"),c(),l("ngIf",e.err())}}function Y(o,t){if(o&1){let e=C();a(0,"button",26),f("click",function(){let i=m(e).$implicit,d=p(2);return g(d.add(i))}),a(1,"div",27),s(2),r(),a(3,"div",28),s(4),r()()}if(o&2){let e=t.$implicit,n=p(2);c(2),u(e.name),c(2),v("$ ",n.toMoney(e.price))}}function Z(o,t){if(o&1){let e=C();a(0,"div",34)(1,"div")(2,"div",27),s(3),r(),a(4,"div",9),s(5),r()(),a(6,"div",35)(7,"button",36),f("click",function(){let i=m(e).$implicit,d=p(3);return g(d.dec(i))}),s(8,"\u2212"),r(),a(9,"span"),s(10),r(),a(11,"button",36),f("click",function(){let i=m(e).$implicit,d=p(3);return g(d.inc(i))}),s(12,"+"),r()(),a(13,"div",37),s(14),r()()}if(o&2){let e=t.$implicit;c(3),u(e.name),c(2),N("$ ",e.price.toFixed(2)," x ",e.qty),c(5),u(e.qty),c(4),v("$ ",(e.price*e.qty).toFixed(2))}}function ee(o,t){if(o&1&&(a(0,"p",38),s(1),r()),o&2){let e=p(3);c(),u(e.ok())}}function te(o,t){if(o&1&&(a(0,"p",17),s(1),r()),o&2){let e=p(3);c(),u(e.err())}}function ne(o,t){if(o&1){let e=C();a(0,"div",29),x(1,Z,15,5,"div",30),a(2,"div",31)(3,"div",32)(4,"span"),s(5,"Total"),r(),a(6,"b"),s(7),r()(),a(8,"button",15),f("click",function(){m(e);let i=p(2);return g(i.payCash())}),s(9),r(),x(10,ee,2,1,"p",33)(11,te,2,1,"p",16),r()()}if(o&2){let e=p(2);c(),l("ngForOf",e.cart()),c(6),v("$ ",e.total().toFixed(2)),c(),l("disabled",e.paying()),c(),u(e.paying()?"Procesando\u2026":"Cobrar CASH"),c(),l("ngIf",e.ok()),c(),l("ngIf",e.err())}}function ie(o,t){o&1&&(a(0,"div",9),s(1,"Agrega productos para comenzar una venta."),r())}function oe(o,t){if(o&1){let e=C();a(0,"div",18)(1,"section",19)(2,"div",20)(3,"h3"),s(4,"Productos"),r(),a(5,"button",21),f("click",function(){m(e);let i=p();return g(i.createDemo())}),s(6,"+ Demo"),r()(),a(7,"input",22),P("ngModelChange",function(i){m(e);let d=p();return h(d.q,i)||(d.q=i),g(i)}),r(),a(8,"div",23),x(9,Y,5,2,"button",24),r()(),a(10,"section",19)(11,"div",20)(12,"h3"),s(13,"Carrito"),r(),a(14,"div",9),s(15),r()(),x(16,ne,12,6,"div",25)(17,ie,2,0,"ng-template",null,1,w),r()()}if(o&2){let e=S(18),n=p();c(7),y("ngModel",n.q),c(2),l("ngForOf",n.filtered()),c(6),v("",n.cart().length," l\xEDneas"),c(),l("ngIf",n.cart().length)("ngIfElse",e)}}var $=class o{reg=b(D);cash=b(R);productsApi=b(B);sales=b(M);registerId=this.reg.selectedId;session=_(null);products=_([]);cart=_([]);q="";opening=100;note="";busy=_(!1);paying=_(!1);err=_("");ok=_("");total=O(()=>this.cart().reduce((t,e)=>t+e.price*e.qty,0));filtered=O(()=>{let t=this.q.trim().toLowerCase(),e=this.products();return t?e.filter(n=>n.name.toLowerCase().includes(t)||(n.sku||"").toLowerCase().includes(t)):e});constructor(){this.load()}load(){let t=this.registerId();t&&(this.productsApi.list().subscribe({next:e=>this.products.set(e)}),this.cash.getOpen(t).subscribe({next:e=>this.session.set(e),error:()=>this.err.set("No se pudo verificar la sesi\xF3n de caja.")}))}toMoney(t){let e=Number(t);return Number.isFinite(e)?e.toFixed(2):t}openSession(){let t=this.registerId();t&&(this.err.set(""),this.ok.set(""),this.busy.set(!0),this.cash.open(t,Number(this.opening),this.note||void 0).subscribe({next:e=>{this.session.set(e),this.busy.set(!1)},error:e=>{this.busy.set(!1);let n=e?.error?.message;this.err.set(Array.isArray(n)?n.join(", "):n||"No se pudo abrir la caja.")}}))}createDemo(){this.productsApi.create({name:"Producto Demo",price:5}).subscribe({next:()=>this.productsApi.list().subscribe(t=>this.products.set(t)),error:()=>this.err.set("No se pudo crear el producto demo.")})}add(t){this.err.set(""),this.ok.set("");let e=Number(t.price),n=[...this.cart()],i=n.find(d=>d.id===t.id);i?i.qty+=1:n.push({id:t.id,name:t.name,price:Number.isFinite(e)?e:0,qty:1}),this.cart.set(n)}inc(t){let e=[...this.cart()],n=e.find(i=>i.id===t.id);n&&(n.qty+=1),this.cart.set(e)}dec(t){let e=[...this.cart()],n=e.find(i=>i.id===t.id);n&&(n.qty-=1,this.cart.set(n.qty<=0?e.filter(i=>i.id!==t.id):e))}payCash(){let t=this.session();if(!t){this.err.set("No hay sesi\xF3n abierta.");return}if(!this.cart().length)return;this.err.set(""),this.ok.set(""),this.paying.set(!0);let e=this.total(),n={cashSessionId:t.id,items:this.cart().map(i=>({productId:i.id,qty:i.qty})),payments:[{method:"CASH",amount:e.toFixed(2)}]};this.sales.createSale(n).subscribe({next:i=>{this.paying.set(!1),this.cart.set([]),this.ok.set(`\u2705 Venta OK: ${i?.id||"OK"}`)},error:i=>{this.paying.set(!1);let d=i?.error?.message;this.err.set(Array.isArray(d)?d.join(", "):d||"No se pudo completar la venta.")}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=k({type:o,selectors:[["ng-component"]],decls:9,vars:3,consts:[["noSession",""],["empty",""],[1,"wrap"],[1,"bar"],["routerLink","/register",1,"link"],["class","status",4,"ngIf"],["class","panel",4,"ngIf"],["class","layout",4,"ngIf"],[1,"status"],[1,"muted"],[4,"ngIf","ngIfElse"],[1,"panel"],[1,"grid"],["type","number","step","0.01",3,"ngModelChange","ngModel"],["placeholder","Ej: Cambio inicial",3,"ngModelChange","ngModel"],[1,"btn","primary",3,"click","disabled"],["class","err",4,"ngIf"],[1,"err"],[1,"layout"],[1,"card"],[1,"cardHead"],[1,"btn",3,"click"],["placeholder","Buscar\u2026",1,"search",3,"ngModelChange","ngModel"],[1,"list"],["class","product",3,"click",4,"ngFor","ngForOf"],["class","cart",4,"ngIf","ngIfElse"],[1,"product",3,"click"],[1,"name"],[1,"price"],[1,"cart"],["class","line",4,"ngFor","ngForOf"],[1,"totals"],[1,"row"],["class","ok",4,"ngIf"],[1,"line"],[1,"qty"],[1,"mini",3,"click"],[1,"lineTotal"],[1,"ok"]],template:function(e,n){e&1&&(a(0,"div",2)(1,"div",3)(2,"h2"),s(3,"POS"),r(),a(4,"a",4),s(5,"Cambiar caja"),r()(),x(6,Q,12,3,"div",5)(7,X,15,5,"div",6)(8,oe,19,5,"div",7),r()),e&2&&(c(6),l("ngIf",n.registerId()),c(),l("ngIf",!n.session()),c(),l("ngIf",n.session()))},dependencies:[A,T,V,z,j,W,L,H,q],styles:[".wrap[_ngcontent-%COMP%]{max-width:1100px;margin:18px auto;padding:0 14px}.bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:10px}.bar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:22px}.link[_ngcontent-%COMP%]{color:#111;text-decoration:underline;font-size:13px}.status[_ngcontent-%COMP%]{margin:10px 0 14px;display:flex;gap:14px;flex-wrap:wrap}.status[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background:#fff;border:1px solid #eee;border-radius:14px;padding:10px 12px}code[_ngcontent-%COMP%]{background:#f6f6f6;padding:2px 6px;border-radius:6px}.muted[_ngcontent-%COMP%]{color:#666;font-size:13px}.panel[_ngcontent-%COMP%]{background:#fff;border:1px dashed #ccc;border-radius:14px;padding:14px}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:10px 0 12px}label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:12px;color:#555;margin-bottom:6px}input[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #dcdcdc}.btn[_ngcontent-%COMP%]{padding:9px 12px;border-radius:10px;border:1px solid #ddd;background:#fff;cursor:pointer}.btn.primary[_ngcontent-%COMP%]{background:#111;color:#fff;border-color:#111}.btn[_ngcontent-%COMP%]:disabled{opacity:.65;cursor:default}.layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:14px}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid #eee;border-radius:16px;padding:14px}.cardHead[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}h3[_ngcontent-%COMP%]{margin:0;font-size:16px}.search[_ngcontent-%COMP%]{margin-bottom:10px}.list[_ngcontent-%COMP%]{display:grid;gap:8px;max-height:520px;overflow:auto;padding-right:4px}.product[_ngcontent-%COMP%]{text-align:left;padding:10px 12px;border-radius:12px;border:1px solid #eee;background:#fff;cursor:pointer;display:flex;justify-content:space-between}.product[_ngcontent-%COMP%]:hover{border-color:#bbb}.product[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600}.product[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{color:#333}.cart[_ngcontent-%COMP%]{display:grid;gap:10px}.line[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;border:1px solid #eee;border-radius:12px;padding:10px 12px}.qty[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.mini[_ngcontent-%COMP%]{width:34px;height:34px;border-radius:10px;border:1px solid #ddd;background:#fff;cursor:pointer}.lineTotal[_ngcontent-%COMP%]{font-weight:600}.totals[_ngcontent-%COMP%]{border-top:1px solid #eee;padding-top:10px;display:grid;gap:8px}.row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.ok[_ngcontent-%COMP%]{margin:0;color:#0a7a2f;font-size:13px}.err[_ngcontent-%COMP%]{margin:0;color:#b00020;font-size:13px}@media(max-width:900px){.layout[_ngcontent-%COMP%], .grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{$ as PosComponent};
