<div class="page">
  <div class="page-head">
    <div>
      <h1>Configuración del TPV</h1>
      <p class="muted">Ajustes por caja: fondo inicial y reglas de operación.</p>
    </div>
    <div class="actions">
      <a class="btn" routerLink="/settings/payment-methods">Métodos de pago</a>
      <a class="btn" routerLink="/settings/denominations">Denominaciones</a>
    </div>
  </div>

  <div class="card">
    <div class="filters">
      <label>
        <span>Caja</span>
        <select [(ngModel)]="registerId" (ngModelChange)="load()">
          <option value="">— Seleccionar —</option>
          <option *ngFor="let r of registers()" [value]="r.id">{{ r.name }}</option>
        </select>
      </label>

      <label>
        <span>Fondo inicial (cambio)</span>
        <input [(ngModel)]="defaultOpeningFloat" type="number" step="0.01" />
      </label>

      <label>
        <span>Tipo de moneda</span>
        <select [(ngModel)]="currency">
          <option value="CUP">CUP</option>
          <option value="USD">USD</option>
        </select>
      </label>

      <label>
        <span>Almacén</span>
        <select [(ngModel)]="warehouseId">
          <option value="">— Seleccionar —</option>
          <option *ngFor="let w of warehousesList()" [value]="w.id">{{ w.name }}</option>
        </select>
      </label>
    </div>

    <div class="filters">
      <label>
        <span>Métodos de pago</span>
        <div class="checkbox-group">
          <label *ngFor="let pm of paymentMethods()">
            <input type="checkbox" [checked]="isPaymentMethodSelected(pm.code)" (change)="togglePaymentMethod(pm.code)" />
            {{ pm.name }}
          </label>
        </div>
      </label>

      <label>
        <span>Denominaciones</span>
        <div class="checkbox-group">
          <label *ngFor="let d of denominations()">
            <input type="checkbox" [checked]="isDenominationSelected(d.value)" (change)="toggleDenomination(d.value)" />
            {{ d.value }}
          </label>
        </div>
      </label>
    </div>

    <div class="row mt">
      <button class="btn primary" (click)="save()" [disabled]="!registerId || busy()">Guardar</button>
      <span class="muted" *ngIf="busy()">Guardando…</span>
      <span class="muted" *ngIf="error()">Backend pendiente: <code>/api/settings/register/:id</code></span>
    </div>

    <div class="note mt">
      <b>Tip CEO:</b> Mantén el fondo inicial estable. Evita "inventarte" el cambio en medio del turno: te rompe el IPV.
    </div>
  </div>
</div>